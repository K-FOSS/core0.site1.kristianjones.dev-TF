.:{{ env "NOMAD_PORT_dns" }} {
  health 0.0.0.0:{{ env "NOMAD_PORT_health" }}

  metadata .

  trace zipkin http://tempo-distributor-http-cont.service.kjdev:9411 {
    client_server
  }

  fanout . 127.0.0.1:5320 127.0.0.1:5330 127.0.0.1:5310 127.0.0.1:5380 {
    worker-count 4
  }
}

.:5310 {
  fanout . tls://1.1.1.1 tls://1.0.0.1 {
    tls-server cloudflare-dns.com

    except kjdev service.kjdev addr.kjdev dc1.kjdev *.kjdev net.kjdev *.net.kjdev
  }  
}

.:5380 {
  fanout . tls://8.8.8.8 tls://8.8.4.4 {
    tls-server dns.google

    except kjdev service.kjdev addr.kjdev dc1.kjdev *.kjdev net.kjdev *.net.kjdev
  }
}

.:5320 {
  fanout . 172.16.0.10:8600 172.16.0.11:8600 172.16.0.12:8600 172.16.0.13:8600 {
    except net.kjdev *.net.kjdev

    worker-count 8
  }
}

.:5330 {
  health 0.0.0.0:{{ env "NOMAD_PORT_netdnshealth" }}

  netbox {
    token ${Netbox.Token}
    url http://${Netbox.Hostname}:${Netbox.Port}/api/ipam/ip-addresses
    localCacheDuration 5m
  }

  secondary kristianjones.dev 100.16.172.in-addr.arpa. {
    transfer from 172.16.0.10:8153 172.16.0.11:8153 172.16.0.12:8153 172.16.0.12:8153
  }
}

